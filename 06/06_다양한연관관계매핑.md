# 06. 다양한 연관관계 매핑

Entity 연관관계의 3가지 고려 사항

다중성 / 단,양방향 / 연관관계의 주인

**다중성** : @ManyToOne, @OneToMany, @OneToOne, @ManyToMany(실무에서 거의 사용되지 않음)

**단,양발향** : 객체참조가 단방향 or 양방향 인가?

**연관관계의 주인** : 두 개체의 연관관계에서 외래 키를 관리하는 곳이 주인이 된다.

## 6.1 다대일

테이블에서 다대일 관계에서 FK는 다대 쪽에 있다. 그러므로 다대 쪽이 연관관계의 주인이 된다.

팀(1) : 회원(N) > 회원이 주인이 된다. (FK 관리하므로)


### 6.1.1 다대일 단방향 (N:1)

![image](https://github.com/hanbroz/jpa/blob/master/05/images/img1.png)<br>
<그림 5.4 다대일 연관관계1 | 다대일(N:1), 단방향>

### 6.1.2 다대일 양방향 (N:1, 1:N)

![image](https://github.com/hanbroz/jpa/blob/master/06/images/img7.png)<br>
<그림 6.2 다대일 양방향>

* 양방향은 FK가 있는 쪽이 연관관계의 주인이다. FK를 관리하는 테이블
* 양방향은 항상 서로를 참조해야 하는데.. 무한루프에 빠지지 않도록 검사로직이 필요하다.

~~~java

    public class Member {
    
        ...
        
        public void setTeam(Team team) {
            this.team = team;
            
            // 무한루프 방지
            if(!team.getMembmers().contains(this)) {
                team.getMembers().add(this);
            }
        }
    }
    
    public class Team {
    
        ...
        
        public void addMember(Member member) {
            this.member.add(member);
            
            if(member.getTeam() !=this) {
                member.setTeam(this);
            }
        }
    
    }

~~~

## 6.2 일대다

다대일 관계의 반대 방향으로 자바의 콜렉션 객체를 사용해야 한다.

### 6.2.1 일대다 단방향 [1:N]





