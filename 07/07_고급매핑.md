# 07. 고급매핑

## 7.1 상속 관계 매핑

관계형 DB는 상속이라는 개념이 없음 > 슈퍼타입과 서브타입이 존재 함

![image](https://github.com/hanbroz/jpa/blob/master/07/images/img7_1.png)<br>
<슈퍼타입과 서브타입 논리모델>

![image](https://github.com/hanbroz/jpa/blob/master/07/images/img7_2.png)<br>
<객체 상속 모델>

테이블로 구성하는 3가지 전략

1. 각각의 테이블로 정의 (중복데이터 발생)
2. 통합 테이블로 변환 (역정규화)
3. 서브타입 테이블로 변환 (정규화)

### 7.1.1 조인 전략

Entity를 각각의 테이블로 만들고 자식 테이블이 부모의 PK를 받아서 PK+FK로 사용하는 전략 > Join이 자주 사용됨 > 테이블에 타입을 구분할 수 있는 컬럼이 필요함

![image](https://github.com/hanbroz/jpa/blob/master/07/images/img7_3.png)<br>
<식별관계구성>

~~~java

@Entity
@Inheritance(strategy = Inheritance.JOINED) //상속매핑은 부모 클래스에 @Inheritance를 사용해야 한다. JOIN 전략 사용
@DiscriminatorColumn(name = "DTYPE") // 부모 클래스에서 사용할 구분컬럼을 지정
public abstract class Item {
    ...
}

@Entity
@DiscriminatorValue(ItemType.ALBUM)
public class Album extends Item {
    ...
}

@Entity
@DiscriminatorValue(ItemType.MOVIE) // Entity를 저장할 때 구분 컬럼에 입력할 값을 지정, M을 지정하면 DTYPE에는 "M"이 들어간다. ENUM화 필요
public class Movie extends Item {
    ...
}

public enum ItemType {
    
    ALBUM("A000")
    , MOVIE("A010")
    , BOOK("A020")
    
}

~~~

기본적으로 자식 테이블은 부모 테이블의 ID 컬럼명을 그대로 사용하게 되는데 변경하려고 하는 경우 다음과 같이 선언 함

![image](https://github.com/hanbroz/jpa/blob/master/07/images/img7_3_1.png)<br>
<서브타입 키 변경>

~~~java

@Entity
@DiscriminatorValue(ItemType.BOOK) // Entity를 저장할 때 구분 컬럼에 입력할 값을 지정, M을 지정하면 DTYPE에는 "M"이 들어간다. ENUM화 필요
@PrimaryKeyJoinColumn(name="BOOK_ID")
public class BOOK extends Item {
    ...
}

~~~



